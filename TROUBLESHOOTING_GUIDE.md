# دليل استكشاف الأخطاء - PiADs

## خطأ "TypeError: Failed to fetch" عند نشر إعلان

### الأسباب المحتملة:

#### 1. عدم إعداد Supabase
**الأعراض:**
- ظهور خطأ "Failed to fetch" عند نشر إعلان
- رسالة في Console: "Supabase not configured"

**الحل:**
```bash
# تحقق من وجود متغيرات البيئة
1. افتح ملف .env.local
2. تأكد من وجود:
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# احصل على المعلومات من Supabase Dashboard
1. اذهب إلى https://supabase.com/dashboard
2. اختر مشروعك
3. اذهب إلى Settings > API
4. انسخ URL و anon/public key
```

#### 2. قاعدة البيانات غير جاهزة
**الأعراض:**
- خطأ في إنشاء الإعلان
- رسالة "table doesn't exist" في Console

**الحل:**
```sql
-- نفذ السكريبت من ملف scripts/setup-database.sql
-- أو استخدم أداة تنفيذ السكريبت المدمجة
```

#### 3. مشكلة في رفع الصور
**الأعراض:**
- الصور لا تُحمل
- الإعلان لا يُنشر

**الحل:**
- تأكد من أن حجم الصورة أقل من 5MB
- تأكد من أن نوع الملف هو: JPEG, PNG, WebP, أو GIF
- جرب تقليل عدد الصور (ابدأ بصورة واحدة)

#### 4. مشاكل الشبكة
**الأعراض:**
- خطأ "Network error"
- الطلب يستغرق وقتاً طويلاً

**الحل:**
```bash
# تحقق من الاتصال بالإنترنت
1. تأكد من اتصالك بالإنترنت
2. حاول تحديث الصفحة
3. امسح الكاش (Ctrl+Shift+R أو Cmd+Shift+R)
```

---

## كيفية فحص الأخطاء

### 1. افتح Console المتصفح
```
- Chrome/Edge: F12 أو Ctrl+Shift+J
- Firefox: F12 أو Ctrl+Shift+K
- Safari: Cmd+Option+C
```

### 2. ابحث عن رسائل [v0]
جميع رسائل التطبيق تبدأ بـ `[v0]` لسهولة التتبع:

```javascript
[v0] Starting ad submission process...
[v0] Checking user ad limits...
[v0] User ad stats: { totalAds: 0, activeAds: 0, adLimit: 3 }
[v0] Validating images: 5
[v0] Creating ad in database...
[v0] Ad created successfully: abc123
```

### 3. رسائل الأخطاء الشائعة

#### "Supabase not configured"
```
الحل: أضف متغيرات البيئة لـ Supabase
```

#### "table 'ads' doesn't exist"
```
الحل: نفذ سكريبت إعداد قاعدة البيانات
```

#### "Failed to create ad: Invalid input"
```
الحل: تحقق من جميع الحقول المطلوبة
```

#### "Network error"
```
الحل: تحقق من اتصالك بالإنترنت وإعدادات CORS
```

---

## خطوات استكشاف الأخطاء المنهجية

### الخطوة 1: التحقق من الإعدادات الأساسية
```bash
✓ هل متغيرات البيئة موجودة؟
✓ هل قاعدة البيانات جاهزة؟
✓ هل المستخدم مسجل دخول؟
```

### الخطوة 2: التحقق من البيانات
```bash
✓ هل جميع الحقول مملوءة؟
✓ هل الصور محملة بنجاح؟
✓ هل السعر رقم صحيح؟
```

### الخطوة 3: فحص السجلات (Logs)
```javascript
// ابحث عن:
[v0] Error - رسائل الأخطاء
[v0] Warning - تحذيرات
[v0] Starting/Creating/Successfully - العمليات الناجحة
```

### الخطوة 4: اختبار الاتصال بقاعدة البيانات
```javascript
// في Console المتصفح:
fetch('YOUR_SUPABASE_URL/rest/v1/', {
  headers: {
    'apikey': 'YOUR_ANON_KEY'
  }
})
.then(r => console.log('Connected:', r.ok))
.catch(e => console.error('Not connected:', e))
```

---

## أخطاء محددة وحلولها

### خطأ: "Maximum 6 images allowed"
**السبب:** محاولة تحميل أكثر من 6 صور
**الحل:** احذف بعض الصور قبل إضافة صور جديدة

### خطأ: "File size too large (max 5MB)"
**السبب:** حجم الصورة أكبر من 5 ميجابايت
**الحل:** 
- استخدم أداة ضغط الصور مثل TinyPNG
- صغّر دقة الصورة
- استخدم صيغة JPEG بدلاً من PNG

### خطأ: "Please fill in all required fields"
**السبب:** أحد الحقول المطلوبة فارغ
**الحل:** املأ جميع الحقول:
- العنوان
- الوصف
- السعر
- الفئة
- المنطقة
- صورة واحدة على الأقل

### خطأ: "You've reached your ad limit"
**السبب:** وصلت إلى الحد الأقصى من الإعلانات حسب اشتراكك
**الحل:**
- احذف إعلانات قديمة
- قم بترقية اشتراكك من صفحة الملف الشخصي

---

## نصائح لتجنب الأخطاء

### 1. رفع الصور
- احفظ الصور بجودة متوسطة (85%)
- استخدم JPEG للصور العادية
- استخدم PNG فقط للشعارات أو الصور التي تحتاج شفافية
- لا تحمل أكثر من 3 صور في وقت واحد

### 2. البيانات
- اكتب عنواناً واضحاً وموجزاً
- ضع وصفاً تفصيلياً للمنتج
- تأكد من السعر قبل النشر
- اختر الفئة المناسبة

### 3. الشبكة
- استخدم اتصال إنترنت مستقر
- لا تنشر إعلانات أثناء اتصال ضعيف
- انتظر حتى تكتمل عملية رفع الصور

---

## معلومات الدعم الفني

### معلومات مفيدة عند الإبلاغ عن خطأ:
1. نوع المتصفح والإصدار
2. نظام التشغيل
3. رسالة الخطأ الكاملة من Console
4. الخطوات التي قمت بها قبل حدوث الخطأ
5. لقطة شاشة للخطأ (إن أمكن)

### كيفية نسخ رسائل Console:
```
1. افتح Console (F12)
2. انقر بزر الفأرة الأيمن على الرسالة
3. اختر "Copy" أو "Copy message"
4. الصق في رسالة الدعم
```

---

## الوضع الآمن (Safe Mode)

إذا استمرت المشاكل، جرب:

### 1. امسح بيانات المتصفح
```
Chrome: Settings > Privacy > Clear browsing data
Firefox: Options > Privacy > Clear Data
Safari: Preferences > Privacy > Manage Website Data
```

### 2. استخدم وضع التصفح الخفي
```
- افتح نافذة جديدة في وضع Incognito/Private
- سجل دخولك مرة أخرى
- حاول نشر إعلان
```

### 3. جرب متصفحاً آخر
```
إذا كنت تستخدم Chrome، جرب Firefox أو Safari
هذا يساعد في تحديد إذا كانت المشكلة من المتصفح
```

---

## الوقاية خير من العلاج

### تحقق دورياً من:
- [ ] Supabase متصل وقاعدة البيانات تعمل
- [ ] متغيرات البيئة محدثة
- [ ] المتصفح محدث لآخر إصدار
- [ ] لا توجد إعلانات عالقة في حالة "pending"

### احتفظ بنسخة احتياطية من:
- إعدادات Supabase
- متغيرات البيئة
- قاعدة البيانات (من لوحة Supabase)

---

## موارد إضافية

### الوثائق
- [دليل إعداد قاعدة البيانات](./DATABASE_SETUP_QUICK_START.md)
- [دليل التحويل](./DATABASE_MIGRATION_GUIDE.md)
- [دليل إصلاح الشاشة البيضاء](./WHITE_SCREEN_FIX_COMPLETE.md)

### روابط مفيدة
- [Supabase Documentation](https://supabase.com/docs)
- [Next.js Documentation](https://nextjs.org/docs)
- [Pi Network Documentation](https://developers.minepi.com/)

---

## سجل التغييرات

### الإصدار الأخير
- ✅ تحسين معالجة الأخطاء في نشر الإعلانات
- ✅ إضافة رسائل خطأ مفصلة وواضحة
- ✅ تحسين نظام التسجيل (Logging) بـ [v0]
- ✅ إضافة فحوصات قبل الاتصال بقاعدة البيانات
- ✅ معالجة أفضل لأخطاء الشبكة
- ✅ تحقق من صحة البيانات قبل الإرسال

---

تم إعداد هذا الدليل لمساعدتك في حل جميع المشاكل المحتملة. إذا استمرت المشكلة، يرجى الاتصال بالدعم الفني مع تقديم المعلومات المذكورة أعلاه.
