# ุฏููู ุงูุชุญููู ูู localStorage ุฅูู Supabase Database

## ุงููุดููุฉ ุงูุชู ุชู ุญููุง

ูุงู ุงูุชุทุจูู ูุณุชุฎุฏู `localStorage` ูุชุฎุฒูู ุงูุฅุนูุงูุงุชุ ููุง ูุนูู ุฃู:
- โ ุงูุฅุนูุงูุงุช ุชูุฎุฒู ููุท ุนูู ุฌูุงุฒ ุงููุณุชุฎุฏู
- โ ูุง ูููู ูููุณุชุฎุฏููู ุงูุขุฎุฑูู ุฑุคูุฉ ุงูุฅุนูุงูุงุช ุงูููุดูุฑุฉ
- โ ุงูุจูุงูุงุช ุชูููุฏ ุนูุฏ ูุณุญ ุฐุงูุฑุฉ ุงููุชุตูุญ
- โ ูุง ูููู ุงููุตูู ููุจูุงูุงุช ูู ุฃุฌูุฒุฉ ูุชุนุฏุฏุฉ

## ุงูุญู ุงูุฌุฏูุฏ

ุชู ุชุญููู ุงููุธุงู ุจุงููุงูู ูุงุณุชุฎุฏุงู **Supabase PostgreSQL Database** ููู ูุงุนุฏุฉ ุจูุงูุงุช ุณุญุงุจูุฉ ุญููููุฉุ ููุง ูููุฑ:
- โ ุชุฎุฒูู ูุฑูุฒู ูุฌููุน ุงูุฅุนูุงูุงุช
- โ ูููู ูุฌููุน ุงููุณุชุฎุฏููู ุฑุคูุฉ ุงูุฅุนูุงูุงุช ูู ุฃู ุฌูุงุฒ
- โ ูุธุงู ุฃูุงู ูุชูุฏู ูุน Row Level Security (RLS)
- โ ุจูุงูุงุช ุฏุงุฆูุฉ ููุญููุฉ
- โ ุฏุนู ุงูููุช ุงููุนูู ููุฑุณุงุฆู ูุงูุฅุดุนุงุฑุงุช

---

## ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1. ุฅูุดุงุก ุญุณุงุจ Supabase

1. ุงุฐูุจ ุฅูู [https://supabase.com](https://supabase.com)
2. ุณุฌู ุญุณุงุจ ุฌุฏูุฏ (ูุฌุงูู)
3. ุฃูุดุฆ ูุดุฑูุน ุฌุฏูุฏ (Project)
4. ุงุญูุธ ูุนูููุงุช ุงูุงุชุตุงู:
   - Project URL
   - Project API Key (anon/public)

### 2. ุฅุถุงูุฉ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ

ุฃุถู ุงููุชุบูุฑุงุช ุงูุชุงููุฉ ูู ููู `.env.local` ุฃู ูู ุฅุนุฏุงุฏุงุช Vercel:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. ุชูููุฐ ุณูุฑูุจุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

ูู ุจุชูููุฐ ุงูุณูุฑูุจุช ุงูููุฌูุฏ ูู `scripts/setup-database.sql` ูู Supabase:

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู SQL Editor
3. ุงูุตู ูุญุชูู ููู `setup-database.sql`
4. ุงุถุบุท Run

ุณูููู ุงูุณูุฑูุจุช ุจุฅูุดุงุก:
- ุฌุฏูู `ads` - ูุชุฎุฒูู ุงูุฅุนูุงูุงุช
- ุฌุฏูู `reviews` - ูุชุฎุฒูู ุงูุชููููุงุช
- ุฌุฏูู `messages` - ูุชุฎุฒูู ุงูุฑุณุงุฆู
- ุฌุฏูู `notifications` - ูุชุฎุฒูู ุงูุฅุดุนุงุฑุงุช
- Indexes ูุชุณุฑูุน ุงูุงุณุชุนูุงูุงุช
- Security Policies ูุญูุงูุฉ ุงูุจูุงูุงุช

---

## ุงููููุงุช ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ ุชู ุฅูุดุงุคูุง:

1. **`/lib/supabase.ts`**
   - ุฅุนุฏุงุฏ Supabase Client
   - ุชุนุฑูู ุฃููุงุน ูุงุนุฏุฉ ุงูุจูุงูุงุช (TypeScript Types)

2. **`/lib/database.ts`**
   - ุฌููุน ูุธุงุฆู ุงูุชูุงุนู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - CRUD operations ููุฅุนูุงูุงุช ูุงููุฑุงุฌุนุงุช ูุงูุฑุณุงุฆู
   - ูุธุงุฆู ุงูุจุญุซ ูุงูุชุตููุฉ

3. **`/scripts/setup-database.sql`**
   - ุณูุฑูุจุช SQL ูุฅูุดุงุก ุงูุฌุฏุงูู ูุงูุฃูุงู

### ูููุงุช ุชู ุชุญุฏูุซูุง:

1. **`/app/page.tsx`** (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ)
   - ุงุณุชุจุฏุงู `getAllAds()` ุจู `getAds()`
   - ุชุญููู ูู synchronous ุฅูู async operations
   - ุฅุถุงูุฉ loading states

2. **`/app/post/page.tsx`** (ุตูุญุฉ ูุดุฑ ุงูุฅุนูุงู)
   - ุงุณุชุจุฏุงู `createAd()` ุจู `createAd()` ูู database.ts
   - ุงูุชุญูู ูู ุงูุญุฏูุฏ ุจุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - async/await ููุนูููุงุช

3. **`/app/ad/[id]/page.tsx`** (ุตูุญุฉ ุชูุงุตูู ุงูุฅุนูุงู)
   - ุงุณุชุจุฏุงู `getAdById()` ุจุงููุณุฎุฉ ูู database.ts
   - ุชุญููู ุงููุฑุงุฌุนุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - async loading states

4. **`/app/my-ads/page.tsx`** (ุตูุญุฉ ุฅุนูุงูุงุชู)
   - ุงุณุชุจุฏุงู `getUserAds()` ุจุงููุณุฎุฉ ูู database.ts
   - ุชุญุฏูุซ/ุญุฐู ุงูุฅุนูุงูุงุช ุนุจุฑ API
   - async operations

---

## ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ads
```sql
- id (UUID, primary key)
- user_id (text) - ูุนุฑู ุงููุณุชุฎุฏู
- title (text) - ุนููุงู ุงูุฅุนูุงู
- description (text) - ูุตู ุงูุฅุนูุงู
- price (decimal) - ุงูุณุนุฑ ุจุงูู Pi
- category (text) - ุงูุชุตููู
- region (text) - ุงูููุทูุฉ
- images (text[]) - ูุตูููุฉ ุงูุตูุฑ
- status (text) - ุงูุญุงูุฉ (active/pending/sold/expired)
- views (int) - ุนุฏุฏ ุงููุดุงูุฏุงุช
- favorites (int) - ุนุฏุฏ ุงูููุถูุงุช
- is_promoted (boolean) - ุฅุนูุงู ูููุฒ
- promotion_expires_at (timestamp) - ุชุงุฑูุฎ ุงูุชูุงุก ุงูุชุฑููุฌ
- created_at (timestamp) - ุชุงุฑูุฎ ุงูุฅูุดุงุก
- updated_at (timestamp) - ุชุงุฑูุฎ ุงูุชุญุฏูุซ
```

### ุฌุฏูู reviews
```sql
- id (UUID, primary key)
- ad_id (UUID) - ูุนุฑู ุงูุฅุนูุงู
- reviewer_id (text) - ูุนุฑู ุงููููููู
- rating (int) - ุงูุชูููู (1-5)
- comment (text) - ุงูุชุนููู
- created_at (timestamp)
```

### ุฌุฏูู messages
```sql
- id (UUID, primary key)
- ad_id (UUID) - ูุนุฑู ุงูุฅุนูุงู
- sender_id (text) - ุงููุฑุณู
- receiver_id (text) - ุงููุณุชูุจู
- content (text) - ูุต ุงูุฑุณุงูุฉ
- is_read (boolean) - ูู ููุฑุฃุช
- created_at (timestamp)
```

### ุฌุฏูู notifications
```sql
- id (UUID, primary key)
- user_id (text) - ุงููุณุชุฎุฏู
- type (text) - ููุน ุงูุฅุดุนุงุฑ
- title (text) - ุงูุนููุงู
- message (text) - ุงูุฑุณุงูุฉ
- is_read (boolean) - ูู ููุฑุฃุช
- link (text) - ุฑุงุจุท ุงูุฅุดุนุงุฑ
- created_at (timestamp)
```

---

## ููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู ุงูุฌุฏูุฏ

### ูุดุฑ ุฅุนูุงู ุฌุฏูุฏ

```typescript
import { createAd } from '@/lib/database'

const newAd = await createAd({
  user_id: user.id,
  title: "iPhone 15 Pro",
  description: "New condition",
  price: 3.14,
  category: "Electronics",
  region: "Dubai, UAE",
  images: ["url1", "url2"],
  status: "active"
})
```

### ุนุฑุถ ุฌููุน ุงูุฅุนูุงูุงุช

```typescript
import { getAds } from '@/lib/database'

// ุฌููุน ุงูุฅุนูุงูุงุช ุงููุดุทุฉ
const allAds = await getAds({ status: 'active' })

// ุชุตููุฉ ุญุณุจ ุงููุฆุฉ
const electronicsAds = await getAds({ 
  category: 'Electronics',
  status: 'active' 
})

// ุชุตููุฉ ุญุณุจ ุงูููุทูุฉ
const dubaiAds = await getAds({ 
  region: 'Dubai, UAE',
  status: 'active' 
})
```

### ุงูุจุญุซ ุนู ุฅุนูุงูุงุช

```typescript
import { searchAds } from '@/lib/database'

const results = await searchAds("iPhone")
```

### ุฅุถุงูุฉ ูุฑุงุฌุนุฉ

```typescript
import { createReview } from '@/lib/database'

const review = await createReview({
  ad_id: "ad-uuid",
  reviewer_id: user.id,
  rating: 5,
  comment: "Excellent product!"
})
```

---

## ุงูุฃูุงู (Row Level Security)

ุชู ุชุทุจูู ุณูุงุณุงุช ุฃูุงู ุตุงุฑูุฉ:

### ุฌุฏูู ads
- โ ุงูุฌููุน ูููููู ูุฑุงุกุฉ ุงูุฅุนูุงูุงุช ุงููุดุทุฉ
- โ ููุท ุตุงุญุจ ุงูุฅุนูุงู ููููู ุชุนุฏููู ุฃู ุญุฐูู
- โ ุงููุณุชุฎุฏููู ุงููุณุฌููู ููุท ูููููู ุฅูุดุงุก ุฅุนูุงูุงุช

### ุฌุฏูู reviews
- โ ุงูุฌููุน ูููููู ูุฑุงุกุฉ ุงููุฑุงุฌุนุงุช
- โ ุงููุณุชุฎุฏููู ุงููุณุฌููู ููุท ูููููู ูุชุงุจุฉ ูุฑุงุฌุนุงุช
- โ ูุง ูููู ุชุนุฏูู ุฃู ุญุฐู ุงููุฑุงุฌุนุงุช (ููุญูุงุธ ุนูู ุงููุตุฏุงููุฉ)

### ุฌุฏูู messages
- โ ููุท ุงููุฑุณู ูุงููุณุชูุจู ูููููู ูุฑุงุกุฉ ุงูุฑุณุงุฆู
- โ ููุท ุงููุณุชูุจู ููููู ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุกุฉ

### ุฌุฏูู notifications
- โ ููุท ุตุงุญุจ ุงูุฅุดุนุงุฑ ููููู ูุฑุงุกุชู ุฃู ุชุญุฏูุซู

---

## ุงูููุงุฆุฏ ุงูููุชุณุจุฉ

### ูููุณุชุฎุฏููู:
- ๐ฏ ุฅุนูุงูุงุช ูุชุงุญุฉ ููุฌููุน ูู ุฃู ููุงู
- ๐ฏ ูุธุงู ุฑุณุงุฆู ูุฅุดุนุงุฑุงุช ููุฑู
- ๐ฏ ุชููููุงุช ููุฑุงุฌุนุงุช ููุซููุฉ
- ๐ฏ ุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู

### ูููุทูุฑูู:
- ๐๏ธ ูุงุนุฏุฉ ุจูุงูุงุช ุงุญุชุฑุงููุฉ
- ๐๏ธ Type-safe ูุน TypeScript
- ๐๏ธ ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- ๐๏ธ ุฅููุงููุฉ ุฅุถุงูุฉ ููุฒุงุช ูุชูุฏูุฉ

### ููุฃุฏุงุก:
- โก Indexes ูุงุณุชุนูุงูุงุช ุณุฑูุนุฉ
- โก Connection pooling
- โก Real-time subscriptions
- โก Automatic backups

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

```
Error: Invalid Supabase URL or Key
```

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฅุถุงูุฉ `NEXT_PUBLIC_SUPABASE_URL` ู `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู ุจุนุฏ ุฅุถุงูุฉ ุงููุชุบูุฑุงุช

### ุฎุทุฃ ูู ุงูุตูุงุญูุงุช

```
Error: new row violates row-level security policy
```

**ุงูุญู:**
- ุชุฃูุฏ ูู ุชูููุฐ ุณูุฑูุจุช `setup-database.sql` ุจุงููุงูู
- ุชุญูู ูู ุชุณุฌูู ุฏุฎูู ุงููุณุชุฎุฏู

### ุงูุฅุนูุงูุงุช ูุง ุชุธูุฑ

**ุงูุญู:**
- ุงูุชุญ Supabase Dashboard
- ุงุฐูุจ ุฅูู Table Editor
- ุชุญูู ูู ูุฌูุฏ ุจูุงูุงุช ูู ุฌุฏูู `ads`
- ุชุฃูุฏ ูู ุฃู `status = 'active'`

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### 1. ุชูุนูู Real-time
```typescript
// ุงูุงุณุชูุงุน ููุฅุนูุงูุงุช ุงูุฌุฏูุฏุฉ
supabase
  .channel('ads-changes')
  .on('postgres_changes', 
    { event: 'INSERT', schema: 'public', table: 'ads' },
    (payload) => {
      console.log('New ad:', payload.new)
    }
  )
  .subscribe()
```

### 2. ุฅุถุงูุฉ Storage ููุตูุฑ
- ุงุณุชุฎุฏู Supabase Storage ูุชุฎุฒูู ุงูุตูุฑ
- ุจุฏูุงู ูู ุฑูุงุจุท ุฎุงุฑุฌูุฉ

### 3. ุฅุญุตุงุฆูุงุช ูุชูุฏูุฉ
- ุนุฏุฏ ุงููุดุงูุฏุงุช ุงูููููุฉ
- ุฃูุซุฑ ุงููุฆุงุช ุทูุจุงู
- ุชูุงุฑูุฑ ุงููุจูุนุงุช

---

## ุงูุฏุนู ุงูููู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู console.log ูู ุงููุชุตูุญ
2. ุฑุงุฌุน Supabase Dashboard > Logs
3. ุชุฃูุฏ ูู ุชุทุจูู ุฌููุน ุงูุฎุทูุงุช ุจุงูุชุฑุชูุจ

---

## ููุงุญุธุงุช ูููุฉ

- ๐ ูุง ุชุดุงุฑู `SUPABASE_SERVICE_ROLE_KEY` ุฃุจุฏุงู (ุงุณุชุฎุฏู ููุท ANON_KEY)
- ๐ Supabase ุงููุฌุงูู ูุฏุนู 500MB storage ู 2GB bandwidth
- ๐ ููููู ุชุฑุญูู ุงูุจูุงูุงุช ุงููุฏููุฉ ูู localStorage ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
- โ๏ธ ุชุฃูุฏ ูู backup ุงูู database ุจุดูู ุฏูุฑู

---

**ุชู ุงูุชุญููู ุจูุฌุงุญ! ๐**

ุงูุขู ุชุทุจูู PiADs ูุนูู ุจูุงุนุฏุฉ ุจูุงูุงุช ุญููููุฉ ููููู ูุฌููุน ุงููุณุชุฎุฏููู ุฑุคูุฉ ุงูุฅุนูุงูุงุช ูู ุฃู ุฌูุงุฒ!
